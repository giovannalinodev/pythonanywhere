name: OWASP Dependency Check

on:
  schedule:
    - cron: '0 0 * * 0'  # Roda semanalmente aos domingos
  workflow_dispatch:  # Permite acionamento manual

jobs:
  dependency-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Instalar dependências do sistema
        run: |
          sudo apt-get update
          sudo apt-get install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
      
      - name: Instalar dependências Python
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: 'Python-Django-App'
          path: '.'
          format: 'HTML'
          out: 'reports'
          args: >
            --enableExperimental
            --scan **/*.py
            --scan requirements.txt
          
      - name: Verificar relatório gerado
        run: |
          echo "Listando arquivos no diretório reports"
          ls -la reports/
          
      - name: Mostrar resumo do relatório
        run: |
          echo "Resumo do relatório de vulnerabilidades:"
          grep -A 5 "Vulnerabilities Found" reports/dependency-check-report.html || echo "Nenhuma vulnerabilidade encontrada ou padrão não encontrado"